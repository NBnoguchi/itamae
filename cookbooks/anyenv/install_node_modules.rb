# -*- coding: utf-8 -*-

define :install_node_modules, cmd: nil do
  template "node_env.sh" do
    source "templates/node_env.sh"
    variables(user: node[:user])
  end

  name = sprintf "===== Install %s ========", params[:name]
  local_ruby_block "logger info" do
    block do
      Itamae::Logger.info name
    end
  end

  # Add 'source node_env.sh' to command
  cmd = sprintf "source /home/#{node[:user]}/node_env.sh\n%s", params[:cmd]

  execute "install" do
    user node[:user]
    command cmd
  end

  file "node_env.sh" do
    action :delete
  end
end
